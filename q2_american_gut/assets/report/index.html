{% extends "base.html" %}

{% block head %}
    <title>American Gut Report</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="http://underscorejs.org/underscore-min.js"></script>
{% endblock %}

{% block content %}
    <h1>American Gut Report for {{ name }}</h1>
    <img src='./resources/ag_logo.png' alt='American Gut Logo'>

    <!-- adapted from: https://plot.ly/~ayusharyal/239/kde-vs-histogram-plot-of-fares/#code -->
    <div id="alpha-kde"></div>

    <script>
    let DATA = {{ DATA | tojson }};

    let kdeTrace = {
      x: DATA['alpha_kde_x'],
      y: DATA['alpha_kde_y'],
      mode: 'lines',
      name: 'alpha-diversity',
      type: 'scatter',
      xaxis: 'x1',
      yaxis: 'y1'
    };

    let ones = [];
    for (let i = 0; i < _.size(DATA.alpha_markers); i++) {
        ones.push(1);
    }

    // adapted from: https://plot.ly/javascript/text-and-annotations/#styling-and-formatting-annotations
    let alphaMarkers = {
        x:_.values(DATA.alpha_markers),
        y:ones,
        type:'scatter',
        mode:'markers',
        name:'',
        text:_.keys(DATA.alpha_markers),
        marker:{color:'rgba(200, 50, 100, .7)', size:12}
    };

    let data = [kdeTrace, alphaMarkers];
    let layout = {
      showlegend: false,
      title: 'Alpha Diversity Distributions for American Gut Participants ðŸ’©',
      xaxis1: {
        anchor: 'y1',
        side: 'bottom',
        title: "Faith's phylogenetic diversity",
        type: 'linear'
      },
      yaxis1: {
        anchor: 'x1',
        side: 'left',
        title: "Number of people",
        type: 'linear'
      }
    };
    Plotly.plot('alpha-kde', {
      data: data,
      layout: layout
    });

    </script>

{% endblock %}
